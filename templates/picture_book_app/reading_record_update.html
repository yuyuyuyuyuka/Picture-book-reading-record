{% extends "base.html" %}
{% block content %}
<div class="reading-record-container">
    <h1>絵本読み聞かせ記録編集</h1>
    <form method="POST" enctype="multipart/form-data" class="reading-record-form">
        {% csrf_token %}
        
        <!-- 絵本の名前（1行） -->
        <div class="form-row">
            <label for="{{ form.book.id_for_label }}">{{ form.book.label }}</label>
            {{ form.book }}
        </div>

        <!-- 日付、子ども、読んだ回数（1行） -->
        <div class="form-row date-child-read">
            <div>
                <label for="{{ form.date.id_for_label }}">{{ form.date.label }}</label>
                {{ form.date }}
            </div>
            <div>
                <label for="{{ form.child.id_for_label }}">{{ form.child.label }}</label>
                {{ form.child }}
            </div>
            <div>
                <label for="{{ form.read_count.id_for_label }}">{{ form.read_count.label }}</label>
                {{ form.read_count }}
            </div>
        </div>

        <!-- 所有状況、写真、動画（1行） -->
        <div class="form-row" style="display: flex; align-items: flex-start; gap: 10px;">
            <div>
                <label style="font-weight: bold;">{{ form.book_status.label }}</label><br>
                {% for radio in form.book_status %}
                    <div class="form-check" style="margin-left: 10px;">
                        {{ radio.tag }}
                        <label class="form-check-label" for="{{ radio.id_for_label }}">
                            {{ radio.choice_label }}
                        </label><br>
                    </div>
                {% endfor %}
            </div>

            <div>
                <label for="{{ form.photo.id_for_label }}">{{ form.photo.label }}</label><br>
                <input type="file" name="photo" id="{{ form.photo.id_for_label }}">
                
                {% if record.photo %}
                    <div style="margin-top: 10px;">
                        <img src="{{ record.photo.url }}" alt="現在の写真" style="max-width: 150px; height: auto;">
                    </div>
                {% endif %}
            </div>

            <div>
                <label for="{{ form.video.id_for_label }}">{{ form.video.label }}</label><br>
                <input type="file" name="video" id="{{ form.video.id_for_label }}">
                
                {% if record.video %}
                    <div style="margin-top: 10px;">
                        <video controls style="max-width: 150px; height: auto;">
                            <source src="{{ record.video.url }}" type="video/mp4">
                            ブラウザが video タグに対応していません。
                        </video>
                    </div>
                {% endif %}
            </div>
        </div>



        <!-- 簡単記録（1行） -->
        <div class="form-row">
            <label for="{{ form.reading_comments.id_for_label }}">{{ form.reading_comments.label }}</label>
            {{ form.reading_comments }}
        </div>

        <!-- 絵本の感想（1行） -->
        <div class="form-row-review">
            <label for="{{ form.review.id_for_label }}">{{ form.review.label }}</label>
            {{ form.review }}
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <input type="submit" value="保存" class="btn-primary">
        </div>
    </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const readingComments = document.querySelector('select[name="reading_comments"]');
        
        readingComments.addEventListener('change', function() {
            const selectedOptions = Array.from(readingComments.selectedOptions);
            if (selectedOptions.length > 3) {
                alert("簡単記録は最大3つまで選べます。");
                readingComments.value = ''; // 最後の選択を解除する
            }
        });
    });
</script>
{% endblock %}